<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Fun Fact Rolodex - Rithika's Website</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .rolodex-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
            color: white;
        }

        .rolodex-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .rolodex-header h1 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .quote-section {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid rgba(255, 255, 255, 0.3);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-radius: 8px;
        }

        .quote-section p {
            font-style: italic;
            line-height: 1.7;
            margin-bottom: 0.5rem;
        }

        .quote-attribution {
            text-align: right;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .explanation-text {
            line-height: 1.7;
            margin-bottom: 2rem;
        }

        .call-to-action {
            font-weight: 500;
            margin-top: 1rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* 3D Rolodex Styling */
        .desk-surface {
            background: linear-gradient(135deg, #3a2f2a 0%, #2d2520 100%);
            border-radius: 20px;
            padding: 3rem 2rem;
            margin: 2rem 0;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .rolodex-3d {
            perspective: 1200px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            position: relative;
        }

        .rolodex-base {
            position: relative;
            width: 400px;
            height: 300px;
        }

        /* Metal side spindles with rotating wheels */
        .spindle {
            position: absolute;
            width: 100px;
            height: 300px;
            top: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .spindle.left {
            left: -90px;
        }

        .spindle.right {
            right: -90px;
        }

        /* Large rotating wheels */
        .spindle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            background: radial-gradient(circle at 30% 30%, #2a2a2a, #0a0a0a);
            border-radius: 50%;
            box-shadow:
                inset -3px -3px 8px rgba(255, 255, 255, 0.1),
                inset 3px 3px 8px rgba(0, 0, 0, 0.8),
                0 4px 12px rgba(0, 0, 0, 0.6);
            border: 3px solid #1a1a1a;
        }

        /* Wheel grip ridges */
        .spindle::after {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            background: repeating-conic-gradient(
                from 0deg,
                transparent 0deg 8deg,
                rgba(0, 0, 0, 0.4) 8deg 10deg
            );
            border-radius: 50%;
            pointer-events: none;
        }

        /* Metal support bar */
        .spindle .support-bar {
            position: absolute;
            width: 12px;
            height: 100%;
            background: linear-gradient(90deg,
                #2a2a2a 0%,
                #3a3a3a 50%,
                #2a2a2a 100%);
            box-shadow:
                inset -1px 0 2px rgba(0, 0, 0, 0.5),
                1px 0 4px rgba(0, 0, 0, 0.3);
        }

        .card-stack {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .rolodex-card {
            position: absolute;
            width: 360px;
            height: 200px;
            background: linear-gradient(180deg, #fafafa 0%, #f0f0f0 100%);
            border-radius: 4px;
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
            padding: 1.25rem;
            left: 50%;
            top: 50%;
            margin-left: -180px;
            margin-top: -100px;
            transform-origin: center bottom;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 2px solid #e0e0e0;
            border-left: 3px solid #d0d0d0;
        }

        .rolodex-card.flipping {
            animation: flipCard 0.6s ease-in-out;
        }

        @keyframes flipCard {
            0% {
                transform: rotateX(0deg) translateZ(0px);
            }
            50% {
                transform: rotateX(90deg) translateZ(20px);
            }
            100% {
                transform: rotateX(180deg) translateZ(0px);
            }
        }

        .card-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            font-family: 'Courier New', monospace;
            color: #2d2520;
        }

        .card-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.75rem;
            color: #1a1a1a;
            border-bottom: 1px solid #ccc;
            padding-bottom: 0.75rem;
        }

        .card-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .card-fact {
            font-size: 1rem;
            line-height: 1.6;
            flex: 1;
            overflow-y: auto;
            color: #333;
        }

        .card-tabs {
            position: absolute;
            right: 15%;
            top: -24px;
            width: 100px;
            height: 24px;
            background: linear-gradient(180deg, #d0d0d0 0%, #c0c0c0 100%);
            border-radius: 4px 4px 0 0;
            box-shadow:
                0 -2px 4px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            border: 1px solid #b0b0b0;
            border-bottom: none;
        }

        .counter {
            text-align: center;
            margin-top: 2rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            color: white;
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .close-modal:hover {
            color: white;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .search-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
        }

        .search-result-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .search-result-name {
            color: white;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .search-result-fact {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .rolodex-header h1 {
                font-size: 2rem;
            }

            .desk-surface {
                padding: 2rem 1rem;
            }

            .rolodex-base {
                width: 300px;
                height: 240px;
                transform: scale(0.9);
            }

            .rolodex-card {
                width: 280px;
                height: 160px;
                margin-left: -140px;
                margin-top: -80px;
                padding: 1rem;
            }

            .spindle {
                width: 80px;
                height: 240px;
            }

            .spindle.left {
                left: -70px;
            }

            .spindle.right {
                right: -70px;
            }

            .spindle::before {
                width: 70px;
                height: 70px;
            }

            .spindle::after {
                width: 70px;
                height: 70px;
            }

            .card-name {
                font-size: 1.1rem;
            }

            .card-fact {
                font-size: 0.9rem;
            }

            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .action-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="content-container">
            <div class="rolodex-container">
                <div class="rolodex-header">
                    <h1>The Fun Fact Rolodex</h1>
                </div>

                <div class="quote-section">
                    <p>"Will, she's been dead two years and that's the shit I remember. Wonderful stuff, you know, little things like that. Ah, but, those are the things I miss the most. The little idiosyncrasies that only I knew about. That's what made her my wife. Oh she had the goods on me too, she knew all my little peccadilloes. People call these things imperfections, but they're not. Ah, that's the good stuff."</p>
                    <p class="quote-attribution">- From Good Will Hunting</p>
                </div>

                <div class="explanation-text">
                    <p>Rolodex's were used in the dark days to organize business contacts. I thought it'd be cool to have a virtual Rolodex but instead of tracking business info, track fun facts and idiosyncrasies ("the good stuff") about people.</p>
                    <p class="call-to-action">If you know a specific fun fact about someone, submit them to the rolodex below!</p>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" id="shuffleBtn">Shuffle</button>
                    <button class="action-btn" id="searchBtn">Search</button>
                    <button class="action-btn" id="submitBtn">Submit a fun fact</button>
                </div>

                <div class="desk-surface">
                    <div class="rolodex-3d">
                        <div class="rolodex-base">
                            <div class="spindle left">
                                <div class="support-bar"></div>
                            </div>
                            <div class="spindle right">
                                <div class="support-bar"></div>
                            </div>
                            <div class="card-stack" id="cardStack">
                                <div class="rolodex-card">
                                    <div class="card-tabs"></div>
                                    <div class="card-content">
                                        <div class="card-name" id="cardName">Loading...</div>
                                        <div class="card-title" id="cardTitle">Fun Fact</div>
                                        <div class="card-fact" id="cardFact">Loading fun facts...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="counter" id="counter">
                    There are currently 0 contacts in my rolodex.
                </div>
            </div>
        </div>

        <!-- Submit Modal -->
        <div class="modal" id="submitModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Submit a Fun Fact</h2>
                    <button class="close-modal" id="closeSubmit">&times;</button>
                </div>
                <form id="submitForm">
                    <div class="form-group">
                        <label for="personName">Person's Name*</label>
                        <input type="text" id="personName" required placeholder="John Doe">
                    </div>
                    <div class="form-group">
                        <label for="funFact">Fun Fact*</label>
                        <textarea id="funFact" required placeholder="Share something interesting, quirky, or memorable about this person..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="submitterName">Your Name (optional)</label>
                        <input type="text" id="submitterName" placeholder="Anonymous">
                    </div>
                    <button type="submit" class="submit-btn">Submit to Rolodex</button>
                </form>
            </div>
        </div>

        <!-- Search Modal -->
        <div class="modal" id="searchModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Search Rolodex</h2>
                    <button class="close-modal" id="closeSearch">&times;</button>
                </div>
                <input type="text" class="search-input" id="searchInput" placeholder="Search by name...">
                <div class="search-results" id="searchResults">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="nav-content">
                <div class="site-title">
                    <a href="index.html">
                        <img src="/images/logo.jpg" alt="Rithika's website" class="site-logo">
                    </a>
                    <span class="separator">|</span>
                    <span class="current-page">fun-fact-rolodex</span>
                </div>

                <button class="menu-trigger">
                    <span>menu</span>
                </button>
            </div>

            <div class="menu-popup hidden">
                <a href="about.html">about</a>
                <a href="likes.html">likes</a>
                <a href="portfolio.html">portfolio</a>
                <a href="contact.html">connect</a>
            </div>
        </nav>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://pgyyyowlvvyszxyolpgy.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBneXl5b3dsdnZ5c3p4eW9scGd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyNzc5NTIsImV4cCI6MjA3NTg1Mzk1Mn0.fbWfkzZK1mqc9Cv0vA6dhYgonS--7gIhOI4j_Arr2tY';
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // State
        let allFacts = [];
        let currentIndex = 0;

        // DOM Elements
        const shuffleBtn = document.getElementById('shuffleBtn');
        const searchBtn = document.getElementById('searchBtn');
        const submitBtn = document.getElementById('submitBtn');
        const submitModal = document.getElementById('submitModal');
        const searchModal = document.getElementById('searchModal');
        const closeSubmit = document.getElementById('closeSubmit');
        const closeSearch = document.getElementById('closeSearch');
        const submitForm = document.getElementById('submitForm');
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const cardName = document.getElementById('cardName');
        const cardFact = document.getElementById('cardFact');
        const counter = document.getElementById('counter');
        const cardStack = document.getElementById('cardStack');

        // Load fun facts from Supabase
        async function loadFunFacts() {
            try {
                const { data, error } = await supabaseClient
                    .from('fun_facts')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error loading fun facts:', error);

                    // Check if table doesn't exist
                    if (error.message.includes('relation "public.fun_facts" does not exist')) {
                        cardName.textContent = 'Database Not Set Up';
                        cardFact.textContent = 'The fun_facts table needs to be created in Supabase. Please run the SQL setup from SETUP_FUNFACT_ROLODEX.md';
                        return;
                    }
                    throw error;
                }

                allFacts = data || [];
                updateCounter();
                if (allFacts.length > 0) {
                    displayCard(allFacts[0]);
                } else {
                    displayEmptyState();
                }
            } catch (error) {
                console.error('Error loading fun facts:', error);
                displayEmptyState();
            }
        }

        // Display a card
        function displayCard(fact) {
            if (!fact) {
                displayEmptyState();
                return;
            }
            cardName.textContent = fact.person_name;
            cardFact.textContent = fact.fun_fact;
        }

        // Display empty state
        function displayEmptyState() {
            cardName.textContent = 'No entries yet';
            cardFact.textContent = 'Be the first to submit a fun fact!';
        }

        // Update counter
        function updateCounter() {
            counter.textContent = `There are currently ${allFacts.length} contact${allFacts.length !== 1 ? 's' : ''} in my rolodex.`;
        }

        // Shuffle with flip animation
        function shuffleCard() {
            if (allFacts.length === 0) return;

            const card = cardStack.querySelector('.rolodex-card');
            card.classList.add('flipping');

            setTimeout(() => {
                currentIndex = Math.floor(Math.random() * allFacts.length);
                displayCard(allFacts[currentIndex]);
                card.classList.remove('flipping');
            }, 300);
        }

        // Show/hide modals
        function showModal(modal) {
            modal.classList.add('active');
        }

        function hideModal(modal) {
            modal.classList.remove('active');
        }

        // Submit form handler
        submitForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const personName = document.getElementById('personName').value.trim();
            const funFact = document.getElementById('funFact').value.trim();
            const submitterName = document.getElementById('submitterName').value.trim() || 'Anonymous';

            try {
                const { data, error } = await supabaseClient
                    .from('fun_facts')
                    .insert([{
                        person_name: personName,
                        fun_fact: funFact,
                        submitted_by: submitterName
                    }])
                    .select();

                if (error) {
                    console.error('Supabase error:', error);

                    // Check for common errors
                    if (error.message.includes('relation "public.fun_facts" does not exist')) {
                        alert('Database table not set up yet! Please ask Rithika to run the SQL setup from SETUP_FUNFACT_ROLODEX.md');
                    } else if (error.message.includes('permission denied')) {
                        alert('Permission error. The database needs to be configured properly.');
                    } else {
                        alert(`Error: ${error.message}`);
                    }
                    return;
                }

                // Reset form and close modal
                submitForm.reset();
                hideModal(submitModal);

                // Reload facts
                await loadFunFacts();

                alert('Fun fact submitted successfully!');
            } catch (error) {
                console.error('Error submitting fun fact:', error);
                alert(`Unexpected error: ${error.message || 'Please try again.'}`);
            }
        });

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();

            if (searchTerm === '') {
                searchResults.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); text-align: center;">Start typing to search...</p>';
                return;
            }

            const results = allFacts.filter(fact =>
                fact.person_name.toLowerCase().includes(searchTerm)
            );

            if (results.length === 0) {
                searchResults.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); text-align: center;">No results found</p>';
                return;
            }

            searchResults.innerHTML = results.map(fact => `
                <div class="search-result-item" onclick="viewFact(${allFacts.indexOf(fact)})">
                    <div class="search-result-name">${fact.person_name}</div>
                    <div class="search-result-fact">${fact.fun_fact.substring(0, 100)}${fact.fun_fact.length > 100 ? '...' : ''}</div>
                </div>
            `).join('');
        });

        // View specific fact from search
        window.viewFact = function(index) {
            currentIndex = index;
            displayCard(allFacts[index]);
            hideModal(searchModal);
        };

        // Event listeners
        shuffleBtn.addEventListener('click', shuffleCard);
        searchBtn.addEventListener('click', () => {
            searchInput.value = '';
            searchResults.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); text-align: center;">Start typing to search...</p>';
            showModal(searchModal);
        });
        submitBtn.addEventListener('click', () => showModal(submitModal));
        closeSubmit.addEventListener('click', () => hideModal(submitModal));
        closeSearch.addEventListener('click', () => hideModal(searchModal));

        // Close modals on outside click
        submitModal.addEventListener('click', (e) => {
            if (e.target === submitModal) hideModal(submitModal);
        });
        searchModal.addEventListener('click', (e) => {
            if (e.target === searchModal) hideModal(searchModal);
        });

        // Initialize
        loadFunFacts();
    </script>
    <script type="module" src="/main.js"></script>
</body>
</html>
